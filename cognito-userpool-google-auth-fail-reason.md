+++
title = "Cognito + Google SSOでログインできない場合のチェック内容"
date = "2021-05-09"
tags = ["Cognito"]
+++

とにかく作ったばかりのCognitoではやたらとログインできないで悩むことが多い。今までもかなりこの問題の解決に時間を費やしてきた気がする。もちろん大抵のことは簡単な設定ミスによって起きるわけで、どこをチェックしたらいいか自分のためにまとめていくことにした。

## チェックリスト

* サインアップトリガーのLambdaに問題がないか。
	* CloudWatch Logを確認する。
	* 許可するドメインとメールアドレスを入れ違いに設定していないか。
* CognitoのアプリクライアントのコールバックURLにログインで使うページのURLを入力していない。
* Amplifyを使っている場合にaws-exports.jsのredirectSignInが、CognitoのアプリクライアントのコールバックURLと一致していない。例えば末尾に「/」が入っているかいないかなども一致させる。
* GoogleのOAuth 2.0の管理ページのOAuthクライアントの承認済みのリダイレクト URIにCognito UserPoolのドメインが設定されていない。
	* またそのURIのパスが`/oauth2/idpresponse`になっていない。
* Amplifyを使っている場合にaws-exports.jsの内容が間違っている。つまりJavaScriptに設定したUserPool IDなどの値が間違っているということ。
* ログイン時ではなくcdk deploy時だが、コールバックURLの指定を複数したいと思った時にカンマ区切りの文字列を与えて`cdk.Fn.split(","`で分割して配列にしようとした場合、カンマの後ろにスペースが入っている