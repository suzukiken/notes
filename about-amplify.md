+++
title = "Amplifyの使い方"
date = "2021-02-25"
tags = ["Amplify"]
+++

自分のAmplifyの使い方は多分普通と違っていて、すごく簡単にいうと、WebサイトでAmplifyのJavaScriptを使うだけになるべくしている。

つまりこんな感じ

* Amplify JavaScript（Webフレームワーク）: 使う
* バックエンドの構築: Amplifyを使わない
* Amplify CLI: ほぼ使わない
* Amplifyコンソール: あまり使わない
* Amplify Admin UI: 使わない

要はAmplifyでバックエンドを作らないようにしている。

AmplifyのJavaScriptはなぜ使うかというと、[AWS SDK for JavaScript for Browser](https://aws.amazon.com/sdk-for-javascript/)に比べると機能は非常に少ないのだけれど、逆に使いやすいと思ったいるため。

それ以外の部分ではほとんどAmplifyを使っていなくて、バックエンドに関わる部分については、ほぼ全てCDKを使うようにしているので、
むしろ変にAmplifyがバックエンドに絡んでこないように`amplify init`コマンドさえ打たない。

もちろん最初の頃はAmplify CLIをは使っていたのだけど、それをある段階でやめてしまった。

その理由はこんな風に思うようになったから。

1. コマンドラインやAdmin UIは記録するのが難しい

  記録が難しいと、一度作ったものをもう一度作るとか、作ったものを一部変更するというのが難しい。
  少し時間的にブランクがあると、前に作ったあれってどうやって作ったんだったっけ、みたいなことになる。

2. AmplifyのCLIではバックエンドに何が作られるのかわからない

  実は以前は「AmplifyならコマンドだけでGraphQLのAPIが作れるのにCDKとか使ったらめちゃ時間がかかってもったいないだろ」と思っていた。
  確かにCDKで作るのはAmplifyより遥かに時間がかかる。ただその時間の多くは利用するAWSのサービスについての学習に費やされるもので、
  実はその学習こそが別のアイデアを生み出すきっかけになる。だから時間があるならCDKでやる方がいいと思う。
  CDKなら一度作ったものはいつでも再利用できるので、時間のある時にいろんなことを試して引き出しを増やしておけば、
  実はAmplifyと同じ程度に工数を縮められる気もする。

3. 将来困らないか不安

  以前は、Amplify CLIで作ったCognitoのユーザーは別のシステムで利用できるのだろうか、
  とか、Amplifyに無い機能を追加したい時にそれができるのだろうか、という疑問というか不安を感じていた。
  ちなみに今から考えるとそれらは若干混沌とするかもしれないが多分できるだろうと思う。
  ただ、そう思うようになったのは、実は2に書いたCDKを使う中で学習した結果として
  そう思うようになったわけなので、結局はAmplifyでバックエンド作るのやめる、というのが不安の解消方法だったということだ。

といいつつ、完全にJavaScript以外のAmplifyの機能を使わないことにしたか、というとそうでもなくて、やはりAmplifyには便利な部分があるので、一部でまだ使っている。

どこで使っているかというと以下の部分。

## Amplifyコンソール

これを利用する理由はデプロイのための設定が少なくて楽だと思うため。

具体的にはJavaScriptのビルドは当然だけど、Route53にレコードを作って指定したドメインでCloudFrontで公開するところまで、簡単な設定だけでやってくれる。

同じことをCodePipelineで実現することはできるけれど、やってみたらわかると思うけどそれなりの手間が必要になる。手軽にやるならAmplifyコンソールが良い。

## Amplify CLI

バックエンドはCDKで作るけれど、時としAmplify CLIを利用することがある。

具体的にはaws-exports.jsやGraphQL APIのためのjs/tsのクライアント側のコードを生成するときに使うことがある。

ただし、プロジェクトのディレクトリで`amplify init`コマンドを使ってしまうと鬱陶しいことになるので、それ専用のダミーのディレクトリを作ってそこで`amplify init`だとか`amplify codegen`などをして必要なファイルを生成して、生成されたファイルだけ本来のプロジェクトにコピーし、不要になったダミーのディレクトリは削除するといったことをしている。


こんなふうに必要なところだけ使わせてもらっているというのが自分のAmplifyの使い方です。

